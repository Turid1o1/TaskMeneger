<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>УЦС - Отделы</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="shell" id="app-root">
    <aside class="left-nav">
      <div class="brand">УЦС</div>
      <a class="menu-link active" id="nav-dashboard" data-view="dashboard" href="#">Отделы</a>
      <a class="menu-link" id="nav-projects" data-view="projects" href="#">Проекты</a>
      <a class="menu-link" id="nav-tasks" data-view="tasks" href="#">Задачи</a>
      <a class="menu-link" id="nav-reports" data-view="reports" href="#">Отчеты</a>
      <a class="menu-link" id="nav-messenger" data-view="messenger" href="#">Мессенджер</a>
      <a class="menu-link" id="nav-calendar" data-view="calendar" href="#">Календарь</a>
      <a class="menu-link" id="nav-settings" data-view="settings" href="#">Настройки</a>
      <a class="menu-link" href="/login.html">Выход</a>
      <button class="nav-user" id="current-user" data-view="profile" type="button">
        <span class="nav-user-avatar-wrap">
          <img class="nav-user-avatar" id="nav-user-avatar" alt="Аватар профиля">
        </span>
        <span id="current-user-text">—</span>
      </button>
    </aside>

    <main class="workspace">
      <section class="view active" id="view-dashboard">
        <div class="header-row">
          <div>
            <h1>Отделы</h1>
          </div>
          <div class="toolbar">
            <button class="btn btn-md btn-primary" data-view="project-editor">+ Новый проект</button>
            <button class="btn btn-md btn-primary" data-view="task-editor">+ Новое задание</button>
            <button class="btn btn-md btn-secondary" id="clear-department-filter-btn">Все отделы</button>
          </div>
        </div>

        <div class="kanban-grid" id="departments-grid">
          <article class="card-col"><h3>Отделы загружаются...</h3></article>
        </div>
      </section>

      <section class="view" id="view-settings">
        <div class="header-row"><div><h1>Настройки</h1></div></div>
        <div class="grid-2">
          <button class="info-box settings-link" data-view="settings-general"><h3>Общие</h3><p>Язык, часовой пояс, формат даты</p></button>
          <button class="info-box settings-link" data-view="settings-security"><h3>Безопасность</h3><p>2FA, политика пароля, лимит попыток, сессия</p></button>
          <button class="info-box settings-link" data-view="settings-notify"><h3>Уведомления</h3><p>Email, в приложении, дайджест, просрочки</p></button>
          <button class="info-box settings-link" data-view="users"><h3>Пользователи</h3><p>Создание, редактирование, удаление</p></button>
        </div>
      </section>

      <section class="view" id="view-settings-general">
        <div class="header-row"><div><h1>Общие настройки</h1><div class="sub">Язык, часовой пояс, формат даты</div></div><button class="btn btn-md btn-secondary" data-view="settings">Назад</button></div>
        <div class="editor-box">
          <div class="grid-3">
            <div><label>Язык</label><select id="settings-lang"><option value="ru">Русский</option><option value="en">English</option></select></div>
            <div><label>Часовой пояс</label><select id="settings-timezone"><option value="Europe/Moscow">Europe/Moscow</option><option value="UTC">UTC</option></select></div>
            <div><label>Формат даты</label><select id="settings-date-format"><option value="DD.MM.YYYY">DD.MM.YYYY</option><option value="YYYY-MM-DD">YYYY-MM-DD</option></select></div>
          </div>
          <div class="row-actions">
            <button class="btn btn-md btn-primary" id="save-settings-general-btn">Сохранить</button>
            <span class="sub" id="settings-general-message"></span>
          </div>
        </div>
      </section>

      <section class="view" id="view-settings-security">
        <div class="header-row"><div><h1>Безопасность</h1><div class="sub">2FA, политика пароля, лимит попыток, сессия</div></div><button class="btn btn-md btn-secondary" data-view="settings">Назад</button></div>
        <div class="editor-box">
          <div class="grid-3">
            <div><label>2FA</label><select id="settings-2fa"><option value="off">Выключено</option><option value="on">Включено</option></select></div>
            <div><label>Политика пароля</label><select id="settings-password-policy"><option value="standard">Стандартная</option><option value="strict">Строгая</option></select></div>
            <div><label>Лимит попыток входа</label><input id="settings-login-attempts" type="number" min="1" max="20" value="5"></div>
            <div><label>Время сессии (мин)</label><input id="settings-session-minutes" type="number" min="5" max="1440" value="60"></div>
          </div>
          <div class="row-actions">
            <button class="btn btn-md btn-primary" id="save-settings-security-btn">Сохранить</button>
            <span class="sub" id="settings-security-message"></span>
          </div>
        </div>
      </section>

      <section class="view" id="view-settings-notify">
        <div class="header-row"><div><h1>Уведомления</h1><div class="sub">Email, в приложении, дайджест, просрочки</div></div><button class="btn btn-md btn-secondary" data-view="settings">Назад</button></div>
        <div class="editor-box">
          <div class="grid-3">
            <div><label>Email</label><select id="settings-email"><option value="on">Включено</option><option value="off">Выключено</option></select></div>
            <div><label>В приложении</label><select id="settings-inapp"><option value="on">Включено</option><option value="off">Выключено</option></select></div>
            <div><label>Дайджест</label><select id="settings-digest"><option value="daily">Ежедневно</option><option value="weekly">Еженедельно</option><option value="off">Выключено</option></select></div>
            <div><label>Просрочки</label><select id="settings-overdue"><option value="on">Уведомлять</option><option value="off">Не уведомлять</option></select></div>
          </div>
          <div class="row-actions">
            <button class="btn btn-md btn-primary" id="save-settings-notify-btn">Сохранить</button>
            <span class="sub" id="settings-notify-message"></span>
          </div>
        </div>
      </section>

      <section class="view" id="view-calendar">
        <div class="header-row">
          <div><h1>Календарь задач</h1></div>
          <div class="toolbar">
            <select id="calendar-mode">
              <option value="day">День</option>
              <option value="week">Неделя</option>
              <option value="month">Месяц</option>
            </select>
          </div>
        </div>
        <div class="calendar-grid" id="calendar-grid"></div>
        <div class="calendar-nav-bottom">
          <button class="icon-nav-btn" id="calendar-prev-btn" title="Назад" aria-label="Назад">&#8592;</button>
          <div class="calendar-period-label" id="calendar-period-label">Период</div>
          <button class="icon-nav-btn" id="calendar-next-btn" title="Вперед" aria-label="Вперед">&#8594;</button>
        </div>
      </section>

      <section class="view" id="view-messenger">
        <div class="header-row">
          <div><h1>Мессенджер</h1></div>
        </div>
        <div class="editor-box">
          <div class="header-row">
            <div><h3>Чат отдела</h3></div>
            <div class="toolbar">
              <select id="messenger-department-select"></select>
              <button class="btn btn-sm btn-secondary" id="messenger-refresh-department-btn">Обновить</button>
            </div>
          </div>
          <div class="chat-log" id="department-chat-log"></div>
          <div class="row-actions">
            <input id="department-chat-input" placeholder="Сообщение в чат отдела">
            <button class="btn btn-md btn-primary" id="send-department-message-btn">Отправить</button>
          </div>
        </div>
      </section>

      <section class="view" id="view-task-chat">
        <div class="header-row">
          <div>
            <h1 id="task-chat-title">Чат задачи</h1>
            <div class="sub" id="task-chat-subtitle"></div>
          </div>
          <div class="toolbar">
            <button class="btn btn-sm btn-secondary" id="task-chat-refresh-btn">Обновить</button>
            <button class="btn btn-sm btn-secondary" id="task-chat-back-btn">Назад</button>
          </div>
        </div>
        <div class="editor-box task-chat-shell">
          <div class="chat-log task-chat-log-full" id="task-chat-full-log"></div>
          <div class="row-actions task-chat-input-row">
            <input id="task-chat-full-input" placeholder="Сообщение в чат задачи">
            <input id="task-chat-full-file" type="file">
            <button class="btn btn-md btn-primary" id="send-task-chat-full-btn">Отправить</button>
          </div>
        </div>
      </section>

      <section class="view table-view" id="view-projects">
        <div class="header-row"><div><h1>Проекты</h1></div><div class="toolbar"><button class="btn btn-md btn-primary" data-view="project-editor">+ Новый проект</button><button class="btn btn-md btn-secondary" data-view="dashboard">Назад</button></div></div>

        <div class="table-scroll">
          <table class="table" id="projects-table">
            <thead><tr><th>ID</th><th>Название</th><th>Отдел</th><th>Статус</th><th>Кураторы</th><th>Исполнители</th><th>Действия</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="table-pager">
          <button class="icon-nav-btn" id="projects-prev-btn" title="Назад" aria-label="Назад">&#8592;</button>
          <div class="pager-label" id="projects-page-label">Страница 1</div>
          <button class="icon-nav-btn" id="projects-next-btn" title="Вперед" aria-label="Вперед">&#8594;</button>
        </div>
      </section>

      <section class="view" id="view-project-editor">
        <div class="header-row"><div><h1 id="project-editor-title">Создать проект</h1></div><button class="btn btn-md btn-secondary" data-view="projects">Назад к проектам</button></div>
        <div class="editor-box">
          <div class="grid-3">
            <div><label>Название</label><input id="project-name" placeholder="Название проекта"></div>
            <div><label>Отдел</label><select id="project-department"></select></div>
            <div>
              <label>Кураторы</label>
              <div id="project-curators-wrap" class="picker-wrap"></div>
              <button class="btn btn-sm btn-secondary picker-add-btn" id="add-project-curator-btn" type="button">+ Добавить куратора</button>
            </div>
            <div>
              <label>Исполнители</label>
              <div id="project-assignees-wrap" class="picker-wrap"></div>
              <button class="btn btn-sm btn-secondary picker-add-btn" id="add-project-assignee-btn" type="button">+ Добавить исполнителя</button>
            </div>
          </div>
          <div class="row-actions">
            <button class="btn btn-md btn-primary" id="save-project-btn">Сохранить</button>
            <button class="btn btn-md btn-secondary" id="reset-project-btn">Очистить</button>
            <button class="btn btn-md btn-secondary hidden" id="delete-project-editor-btn">Удалить проект</button>
            <span class="sub" id="project-editor-message"></span>
          </div>
        </div>
      </section>

      <section class="view table-view" id="view-tasks">
        <div class="header-row"><div><h1>Задачи</h1></div><div class="toolbar"><button class="btn btn-md btn-primary" data-view="task-editor">+ Новая задача</button><button class="btn btn-md btn-secondary" data-view="dashboard">Назад</button></div></div>
        <div class="table-scroll">
          <table class="table" id="tasks-table">
            <thead><tr><th>ID</th><th>Название</th><th>Отдел</th><th>Тип</th><th>Статус</th><th>Приоритет</th><th>Исполнители</th><th>Кураторы</th><th>Проект</th><th>Действия</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="table-pager">
          <button class="icon-nav-btn" id="tasks-prev-btn" title="Назад" aria-label="Назад">&#8592;</button>
          <div class="pager-label" id="tasks-page-label">Страница 1</div>
          <button class="icon-nav-btn" id="tasks-next-btn" title="Вперед" aria-label="Вперед">&#8594;</button>
        </div>
      </section>

      <section class="view" id="view-task-editor">
        <div class="header-row"><div><h1 id="task-editor-title">Создать задачу</h1></div><button class="btn btn-md btn-secondary" data-view="tasks">Назад</button></div>

        <div class="editor-box">
          <div class="grid-3">
            <div><label>Название</label><input id="task-title" placeholder="Название"></div>
            <div><label>Проект</label><select id="task-project"></select></div>
            <div><label>Тип</label><select id="task-type"><option value="Task">Задача</option><option value="Bug">Ошибка</option><option value="Story">История</option><option value="Epic">Эпик</option></select></div>
            <div><label>Статус</label><select id="task-status"><option value="To Do">К выполнению</option><option value="In Progress">В процессе</option><option value="Review">Проверка</option><option value="Done">Завершено</option></select></div>
            <div><label>Приоритет</label><select id="task-priority"><option value="Low">Низкий</option><option value="Medium">Средний</option><option value="High">Высокий</option><option value="Critical">Критический</option></select></div>
            <div>
              <label>Кураторы</label>
              <div id="task-curators-wrap" class="picker-wrap"></div>
              <button class="btn btn-sm btn-secondary picker-add-btn" id="add-task-curator-btn" type="button">+ Добавить куратора</button>
            </div>
            <div>
              <label>Исполнители</label>
              <div id="task-assignees-wrap" class="picker-wrap"></div>
              <button class="btn btn-sm btn-secondary picker-add-btn" id="add-task-assignee-btn" type="button">+ Добавить исполнителя</button>
            </div>
            <div><label>Срок</label><input id="task-due-date" type="date"></div>
          </div>
          <div><label>Описание</label><textarea id="task-description" placeholder="Описание"></textarea></div>
          <div class="row-actions">
            <button class="btn btn-md btn-primary" id="save-task-btn">Сохранить</button>
            <button class="btn btn-md btn-secondary" id="reset-task-btn">Очистить</button>
            <button class="btn btn-md btn-secondary hidden" id="delete-task-editor-btn">Удалить задачу</button>
            <span class="sub" id="task-editor-message"></span>
          </div>
        </div>
      </section>

      <section class="view table-view" id="view-reports">
        <div class="header-row"><div><h1>Отчеты</h1></div><button class="btn btn-md btn-secondary" data-view="dashboard">Назад</button></div>

        <div class="table-scroll">
          <table class="table" id="reports-table">
            <thead><tr><th>ID</th><th>Тип</th><th>Объект</th><th>Результат</th><th>Автор</th><th>Заголовок</th><th>Файл</th><th>Дата</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="table-pager">
          <button class="icon-nav-btn" id="reports-prev-btn" title="Назад" aria-label="Назад">&#8592;</button>
          <div class="pager-label" id="reports-page-label">Страница 1</div>
          <button class="icon-nav-btn" id="reports-next-btn" title="Вперед" aria-label="Вперед">&#8594;</button>
        </div>
      </section>

      <section class="view" id="view-close-report">
        <div class="header-row">
          <div><h1 id="close-report-title">Закрытие с отчетом</h1></div>
          <button class="btn btn-md btn-secondary" id="close-report-back-btn">Назад</button>
        </div>
        <div class="editor-box">
          <div class="grid-3">
            <div>
              <label>Тип</label>
              <select id="close-target-type">
                <option value="task">Задача</option>
                <option value="project">Проект</option>
              </select>
            </div>
            <div>
              <label>Объект</label>
              <select id="close-target-id"></select>
            </div>
            <div>
              <label>Результат</label>
              <select id="close-result">
                <option value="Промежуточный отчет">Промежуточный отчет</option>
                <option value="Завершено">Завершено</option>
                <option value="Завершено не полностью">Завершено не полностью</option>
                <option value="Не завершено">Не завершено</option>
              </select>
            </div>
          </div>
          <div class="grid-3">
            <div>
              <label>Заголовок</label>
              <input id="close-title" placeholder="Кратко о выполненной работе">
            </div>
            <div>
              <label>Файл (до 50 МБ)</label>
              <input id="close-file" type="file">
            </div>
          </div>
          <div>
            <label>Отчет о решении</label>
            <textarea id="close-resolution" placeholder="Опишите, как был решен вопрос"></textarea>
          </div>
          <div class="row-actions">
            <button class="btn btn-md btn-primary" id="save-close-report-btn">Сохранить отчет</button>
            <span class="sub" id="close-report-message"></span>
          </div>
        </div>
      </section>

      <section class="view" id="view-users">
        <div class="header-row"><div><h1>Пользователи</h1><div class="sub">Редактирование и удаление пользователей</div></div><button class="btn btn-md btn-secondary" data-view="settings">Назад</button></div>

        <div class="editor-box">
          <h3 id="user-editor-title">Редактирование пользователя</h3>
          <div class="grid-3">
            <div><label>Логин</label><input id="user-login"></div>
            <div><label>ФИО</label><input id="user-fullname"></div>
            <div><label>Должность</label><select id="user-position"></select></div>
            <div><label>Отдел</label><select id="user-department"></select></div>
            <div><label>Роль</label><select id="user-role"><option value="Owner">Владелец</option><option value="Admin">Начальник УЦС</option><option value="Project Manager">Начальник отдела</option><option value="Member">Сотрудник отдела</option><option value="Guest">Гость</option></select></div>
          </div>
          <div class="row-actions">
            <button class="btn btn-md btn-primary" id="save-user-btn">Сохранить</button>
            <button class="btn btn-md btn-secondary" id="reset-user-btn">Очистить</button>
            <a class="btn btn-md btn-secondary" href="/register.html">Новая регистрация</a>
            <span class="sub" id="user-editor-message"></span>
          </div>
        </div>

        <table class="table" id="users-table">
          <thead><tr><th>ID</th><th>Логин</th><th>ФИО</th><th>Должность</th><th>Отдел</th><th>Роль</th><th>Статус</th><th>Действия</th></tr></thead>
          <tbody></tbody>
        </table>
      </section>

      <section class="view" id="view-profile">
        <div class="header-row"><div><h1>Профиль сотрудника</h1></div><button class="btn btn-md btn-secondary" data-view="dashboard">Назад</button></div>
        <div class="editor-box">
          <div class="grid-3">
            <div><label>Логин</label><input id="profile-login" disabled></div>
            <div><label>ФИО</label><input id="profile-fullname"></div>
            <div><label>Должность</label><select id="profile-position"></select></div>
            <div><label>Новый пароль</label><input id="profile-password" type="password" placeholder="Оставьте пустым, если без смены"></div>
            <div>
              <label>Фото профиля (до 5 МБ)</label>
              <input id="profile-avatar" type="file" accept="image/*">
            </div>
            <div class="profile-avatar-preview-wrap">
              <img id="profile-avatar-preview" class="profile-avatar-preview" alt="Фото профиля">
            </div>
          </div>
          <div class="row-actions">
            <button class="btn btn-md btn-primary" id="save-profile-btn">Сохранить профиль</button>
            <span class="sub" id="profile-message"></span>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="/client.js"></script>
  <script>TaskFlowClient.initAppPage();</script>
</body>
</html>
